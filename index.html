<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>On-Call Generator</title>
    <style>
      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: #020617;
        color: #e5e7eb;
      }
      .navbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem 1.5rem;
        background: #020617;
        border-bottom: 1px solid #111827;
        position: sticky;
        top: 0;
        z-index: 10;
      }
      .logo {
        font-weight: 700;
        color: #38bdf8;
      }
      .nav-links a {
        margin-left: 1rem;
        color: #e5e7eb;
        text-decoration: none;
        font-size: 0.9rem;
      }
      .nav-links a:hover {
        color: #38bdf8;
      }
      .container {
        max-width: 1100px;
        margin: 1.5rem auto;
        padding: 0 1rem 2rem;
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
      }
      .card {
        background: #020617;
        border: 1px solid #111827;
        border-radius: 0.5rem;
        padding: 1rem;
        flex: 1 1 320px;
      }
      h2,
      h3 {
        margin-top: 0;
        color: #f9fafb;
      }
      label {
        display: block;
        font-size: 0.8rem;
        margin-bottom: 0.25rem;
        color: #9ca3af;
      }
      input,
      select {
        width: 100%;
        padding: 0.4rem 0.5rem;
        border-radius: 0.375rem;
        border: 1px solid #1f2937;
        background: #020617;
        color: #e5e7eb;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
      }
      button {
        padding: 0.4rem 0.8rem;
        border-radius: 0.375rem;
        border: none;
        font-size: 0.85rem;
        cursor: pointer;
      }
      .btn-primary {
        background: #38bdf8;
        color: #020617;
      }
      .btn-primary:hover {
        background: #0ea5e9;
      }
      .btn-secondary {
        background: #111827;
        color: #e5e7eb;
        border: 1px solid #1f2937;
      }
      .btn-secondary:hover {
        background: #1f2937;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.85rem;
      }
      th,
      td {
        padding: 0.4rem 0.5rem;
        border-bottom: 1px solid #111827;
        text-align: left;
        vertical-align: top;
      }
      th {
        color: #9ca3af;
        font-weight: 500;
      }
      .section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 0.5rem;
      }
      .badge {
        display: inline-block;
        padding: 0.1rem 0.35rem;
        border-radius: 999px;
        background: #111827;
        font-size: 0.7rem;
        color: #e5e7eb;
      }
      .date-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.25rem;
      }
      .date-tag {
        padding: 0.05rem 0.3rem;
        border-radius: 999px;
        background: #0f172a;
        font-size: 0.7rem;
      }
      .radio-group {
        display: flex;
        gap: 1rem;
        margin: 0.25rem 0 0.75rem;
        font-size: 0.85rem;
        color: #d1d5db;
      }
      /* Modal */
      #modalOverlay {
        position: fixed;
        inset: 0;
        background: rgba(15, 23, 42, 0.7);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 50;
      }
      .modal-box {
        background: #020617;
        border: 1px solid #111827;
        border-radius: 0.5rem;
        padding: 1rem;
        max-width: 420px;
        width: 100%;
      }
      .monday-label {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        font-size: 0.8rem;
        margin-bottom: 0.25rem;
      }
    </style>
  </head>
  <body>
    <div class="navbar">
      <div class="logo">On-Call Generator</div>
      <div class="nav-links">
        <a href="#home">Home</a>
        <a href="#data">Data</a>
      </div>
    </div>

    <div class="container" id="home">
      <!-- Home / Generator card -->
      <div class="card">
        <h2>Generate Schedule</h2>

        <label for="mondaySelect">Select Monday (next 4 weeks)</label>
        <select id="mondaySelect"></select>

        <label>Export type</label>
        <div class="radio-group">
          <label
            ><input type="radio" name="exportType" value="txt" checked /> Text
            file</label
          >
          <label
            ><input type="radio" name="exportType" value="ics" /> Outlook
            (.ics)</label
          >
        </div>

        <button class="btn-primary" id="generateBtn">Generate</button>
        <p
          id="status"
          style="font-size: 0.8rem; color: #9ca3af; margin-top: 0.5rem"
        ></p>
      </div>

      <!-- Data card with tables -->
      <div class="card" id="data">
        <div class="section-header">
          <h3>Contacts</h3>
        </div>
        <table id="contactsTable">
          <thead>
            <tr>
              <th>Name</th>
              <th>Team</th>
              <th>Phone</th>
              <th>Start dates</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>

        <div class="section-header" style="margin-top: 1rem">
          <h3>Emergency contacts</h3>
        </div>
        <table id="emergencyTable">
          <thead>
            <tr>
              <th>Name</th>
              <th>Contact</th>
              <th>Email</th>
              <th>Start dates</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <script>
      // --- Data from your JSON ---
      const contacts = [
        {
          name: "Muzaffer Gurkan Ozel",
          phone: "+90 532 059 63 63",
          team: "MBT Network/DataCenter",
          startDates: ["2025-12-08", "2025-12-29"],
        },
        {
          name: "Abdullah Isilar",
          phone: "+90 537 400 90 17",
          team: "MBT Storage/VM",
          startDates: ["2025-12-08", "2025-12-22"],
        },
        {
          name: "Tahir Evren Kiral",
          phone: "+90 549 549 04 40",
          team: "MBT Server/Citrix",
          startDates: ["2025-12-08", "2025-12-22"],
        },
        {
          name: "Burak Koc",
          phone: "+90 505 260 82 80",
          team: "MBT Database (DB)",
          startDates: ["2025-12-08", "2025-12-15", "2025-12-22", "2025-12-29"],
        },
        {
          name: "Bilal Oner",
          phone: "+90 533 211 72 11",
          team: "MBT Network/DataCenter",
          startDates: ["2025-12-15"],
        },
        {
          name: "Halit Naziroglu",
          phone: "+90 534 200 12 51",
          team: "MBT Network/DataCenter",
          startDates: ["2025-12-22"],
        },
        {
          name: "Mustafa Sari",
          phone: "+90 530 523 91 07",
          team: "MBT Storage/VM",
          startDates: ["2025-12-15", "2025-12-29"],
        },
        {
          name: "Ibrahim Ozer",
          phone: "+90 532 407 56 50",
          team: "MBT Server/Citrix",
          startDates: ["2025-12-15", "2025-12-29"],
        },
      ];

      const emergencyContacts = [
        {
          name: "Sercan Eren",
          phone: "+90 543 534 92 29",
          email: "s@infosys.com",
          startDates: ["2025-12-08"],
        },
        {
          name: "Onur Aydin",
          phone: "+ 90 530 940 53 84 / +90 532 552 71 61",
          email: "o@infosys.com",
          startDates: ["2025-12-29"],
        },
        {
          name: "Aykut Erdonmez",
          phone: "+90 538 276 92 36",
          email: "A@infosys.com",
          startDates: [],
        },
        {
          name: "Ayhan Ay",
          phone: "+90 536 308 18 01",
          email: "A@infosys.com",
          startDates: [],
        },
        {
          name: "Murat Buyukozer",
          phone: "+90 532 272 34 21",
          email: "m@infosys.com",
          startDates: [],
        },
        {
          name: "Mehmet Akif Acar",
          phone: "+00 000 000 00 00",
          email: "mehmet_akif.acar@daimler.com",
          startDates: ["2025-12-15"],
        },
        {
          name: "Cemal Olke",
          phone: "+90 000 000 00 00",
          email: "cemal.olke@daimlertruck.com",
          startDates: ["2025-12-22"],
        },
      ];

      // --- Date helpers ---
      function getNextMondays(count = 4) {
        const mondays = [];
        const today = new Date();
        const date = new Date(
          today.getFullYear(),
          today.getMonth(),
          today.getDate()
        );
        const day = date.getDay(); // 0=Sun,1=Mon
        const diff = (1 - day + 7) % 7;
        date.setDate(date.getDate() + diff);
        for (let i = 0; i < count; i++) {
          const d = new Date(date);
          d.setDate(date.getDate() + i * 7);
          mondays.push(d);
        }
        return mondays;
      }

      function formatDate(d) {
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, "0");
        const day = String(d.getDate()).padStart(2, "0");
        return `${year}-${month}-${day}`;
      }

      function parseDate(str) {
        const [y, m, d] = str.split("-").map(Number);
        return new Date(y, m - 1, d);
      }

      function formatDDMMYYYY(d) {
        const day = String(d.getDate()).padStart(2, "0");
        const month = String(d.getMonth() + 1).padStart(2, "0");
        const year = d.getFullYear();
        return `${day}-${month}-${year}`;
      }

      // --- Fill Monday select ---
      const mondaySelect = document.getElementById("mondaySelect");
      getNextMondays().forEach((d, idx) => {
        const opt = document.createElement("option");
        opt.value = formatDate(d);
        opt.textContent = d.toDateString();
        if (idx === 0) opt.selected = true;
        mondaySelect.appendChild(opt);
      });

      // --- Render tables just for visibility ---
      function renderContacts() {
        const tbody = document.querySelector("#contactsTable tbody");
        tbody.innerHTML = "";
        contacts.forEach((c) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${c.name}</td>
            <td><span class="badge">${c.team}</span></td>
            <td>${c.phone || ""}</td>
            <td>
              <div class="date-tags">
                ${c.startDates
                  .map((d) => `<span class="date-tag">${d}</span>`)
                  .join("")}
              </div>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }

      function renderEmergency() {
        const tbody = document.querySelector("#emergencyTable tbody");
        tbody.innerHTML = "";
        emergencyContacts.forEach((c) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${c.name}</td>
            <td>${c.phone || ""}</td>
            <td>${c.email || ""}</td>
            <td>
              <div class="date-tags">
                ${c.startDates
                  .map((d) => `<span class="date-tag">${d}</span>`)
                  .join("")}
              </div>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }

      renderContacts();
      renderEmergency();

      // --- Build text for given Monday ---
      function buildTextScheduleForMonday(mondayStr) {
        const monday = parseDate(mondayStr);
        const nextMonday = new Date(monday);
        nextMonday.setDate(monday.getDate() + 7);

        const startStr = formatDDMMYYYY(monday) + " (17:15) CET";
        const endStr = formatDDMMYYYY(nextMonday) + " (07:30) CET";

        const activeContacts = contacts.filter(
          (c) => Array.isArray(c.startDates) && c.startDates.includes(mondayStr)
        );

        const activeEmergencies = emergencyContacts.filter(
          (c) => Array.isArray(c.startDates) && c.startDates.includes(mondayStr)
        );

        const lines = [];
        lines.push("Hello Service Desk,");
        lines.push(
          "Please find the updated On-Call Support for MB Turkey Wintel Monitoring Services in your calendar."
        );
        lines.push("");

        activeContacts.forEach((c, idx) => {
          lines.push("Service:      " + c.team);
          lines.push("Colleague:    " + c.name);
          lines.push("Start time:   " + startStr);
          lines.push("End time:     " + endStr);
          if (c.phone) lines.push("Phone:        " + c.phone);
          if (idx !== activeContacts.length - 1) lines.push("");
        });

        lines.push("");
        lines.push("Emergency Case First contact Daimler:");

        // for emergencies, require at least email or phone
        activeEmergencies.forEach((c) => {
          if (!c.phone && !c.email) return;
          lines.push(c.name);
          if (c.phone) lines.push(c.phone);
          if (c.email) lines.push(c.email);
        });

        return lines.join("\n");
      }

      // --- Download helper ---
      function downloadFile(filename, content, mime) {
        const blob = new Blob([content], { type: mime });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      }

      // --- Simple ICS based on text description ---
      function buildIcs(startMonday) {
        const uid = Date.now() + "@oncall";
        const dt = startMonday.replace(/-/g, "");
        const ics =
          "BEGIN:VCALENDAR\n" +
          "VERSION:2.0\n" +
          "PRODID:-//OnCall//EN\n" +
          "CALSCALE:GREGORIAN\n" +
          "METHOD:PUBLISH\n" +
          "BEGIN:VEVENT\n" +
          "UID:" +
          uid +
          "\n" +
          "DTSTART;VALUE=DATE:" +
          dt +
          "\n" +
          "DTEND;VALUE=DATE:" +
          dt +
          "\n" +
          "SUMMARY:On-call schedule\n" +
          "DESCRIPTION:" +
          buildTextScheduleForMonday(startMonday).replace(/\n/g, "\\n") +
          "\n" +
          "END:VEVENT\n" +
          "END:VCALENDAR";
        return ics;
      }

      // --- Generate button ---
      document.getElementById("generateBtn").addEventListener("click", () => {
        const monday = mondaySelect.value;
        const exportType = document.querySelector(
          "input[name='exportType']:checked"
        ).value;
        const status = document.getElementById("status");

        if (!monday) {
          status.textContent = "Select a Monday first.";
          return;
        }

        if (exportType === "txt") {
          const txt = buildTextScheduleForMonday(monday);
          downloadFile(
            "oncall-" + monday + ".txt",
            txt,
            "text/plain;charset=utf-8"
          );
          status.textContent = "Text file downloaded.";
        } else {
          const ics = buildIcs(monday);
          downloadFile(
            "oncall-" + monday + ".ics",
            ics,
            "text/calendar;charset=utf-8"
          );
          status.textContent = "ICS file downloaded.";
        }
      });
    </script>
  </body>
</html>
